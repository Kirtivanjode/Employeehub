<div class="chat-container">
  <div class="chat-sidebar">
    <div class="sidebar-header">
      <h2>Messages</h2>
      <button
        class="btn btn-primary btn-sm"
        (click)="showEmployeeList = !showEmployeeList"
      >
        New Chat
      </button>
    </div>

    <div *ngIf="showEmployeeList" class="employee-list">
      <h3>Employees</h3>
      <div
        *ngFor="let employee of employees"
        class="employee-item"
        (click)="startNewChat(employee.id)"
      >
        <img
          [src]="employee.avatar"
          [alt]="employee.firstName"
          class="employee-avatar"
        />
        <span>{{ employee.firstName }} {{ employee.lastName }}</span>
      </div>
    </div>

    <div class="chat-rooms">
      <div
        *ngFor="let room of chatRooms"
        class="chat-room-item"
        [class.active]="selectedRoom?.id === room.id"
        (click)="selectRoom(room)"
      >
        <div class="room-info">
          <div class="room-name">{{ getRoomDisplayName(room) }}</div>

          <div class="last-message">
            {{ room.lastMessage?.message ?? "" | slice : 0 : 30 }}
            {{ (room.lastMessage?.message ?? "").length > 30 ? "..." : "" }}
          </div>
        </div>
        <div *ngIf="(room.unreadCount ?? 0) > 0" class="unread-badge">
          {{ room.unreadCount ?? 0 }}
        </div>
      </div>
    </div>
  </div>

  <!-- Chat Main Area -->
  <div class="chat-main">
    <div *ngIf="selectedRoom" class="chat-content">
      <!-- Chat Header -->
      <div class="chat-header">
        <h3>{{ getRoomDisplayName(selectedRoom) }}</h3>
        <span class="participant-count" *ngIf="selectedRoom.isGroup">
          {{ selectedRoom.participants.length }} participants
        </span>
      </div>

      <div class="messages-container">
        <div
          *ngFor="let msg of roomMessages"
          class="message"
          [ngClass]="
            msg.senderId === currentUserId ? 'own-message' : 'their-message'
          "
        >
          <div class="message-content">
            <span *ngIf="msg.senderId !== currentUserId" class="sender-name">
              {{ msg.senderName }}:
            </span>
            {{ msg.message }}
          </div>
        </div>
      </div>

      <div class="message-input-container">
        <input
          type="text"
          [(ngModel)]="newMessage"
          (keyup.enter)="sendMessage()"
          placeholder="Type a message..."
          class="message-input"
        />
        <button
          class="btn btn-primary send-btn"
          (click)="sendMessage()"
          [disabled]="!newMessage.trim()"
        >
          Send
        </button>
      </div>
    </div>

    <div *ngIf="!selectedRoom" class="no-chat-selected">
      <div class="no-chat-icon">ðŸ’¬</div>
      <h3>Select a chat to start messaging</h3>
      <p>Choose from your existing conversations or start a new one</p>
    </div>
  </div>
</div>
